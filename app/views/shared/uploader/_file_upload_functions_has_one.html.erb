var <%= file_type %>Functions = {
  fileuploadDone: function(data, file){
    $('.progress.active', data.context)
      .removeClass('progress-striped')
      .removeClass('active');
    $('.progress-bar', data.context).addClass('progress-bar-success');
    $(data.context).remove();
    id = file.id;
    file = file.file || data.result.file;

    inputTpl = '<span><img>';
    inputTpl += '<input type="hidden" name="<%= model %>[<%= attribute_type %>_id]"></span>';
    input = $(inputTpl);
    input.find('input').val(id);
    input.find('img').attr('src', file.<%= image_version %>.url);
    $('.<%= file_type %>.image-preview').html(input);
  },

  fileuploadTargetForProgress: function(data){
    return $('#' + data.context + ' .progress-bar');
  },

  fileuploadTargetForFail: function(data){
    return $('#' + data.context + ' .progress');
  },

  fileuploadAdd: function(data, file){
    tpl = $('<div id="<%= file_type %>-upload"><i>Uploading ' + file.name + '</i><div class="progress progress-striped active"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">Uploading...</div></div></div>');
    $('.<%= file_type %>.image-preview').html(tpl);
    data.context = '<%= file_type %>-upload';
    return data;
  },

  checkFileProcessed: function(fileId, context){
    formData = $('#' + context).data('data');

    window.setTimeout(function() {
      $.ajax({
        url: '/files/' + fileId,
        type: 'GET',
        dataType: 'json',
        data: { context: context },
        async: false,
        success: function(data) {
          processed = data.processed;
          if (!processed) {
            <%= file_type %>Functions.checkFileProcessed(data.id, data.context);
          } else {
            formData = $('#' + data.context).data('data');
            <%= file_type %>Functions.fileuploadDone(formData, data);
          }
        }
      });
    }, 1000);
  }
}