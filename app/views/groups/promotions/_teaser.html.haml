- @promotion = GroupDecorator.decorate @promotion

- if user_signed_in? and member = current_user.is_member?(@promotion) and member.invitation_pending?
  .row
    .col-xs-12
      .alert.alert-warning
        You have been invited to join
        %strong #{@promotion.course.name} @#{@promotion.course.university.full_name}, #{@promotion.name}.
        = link_to 'Join promotion', group_accept_invitation_path(@promotion), class: 'btn btn-warning btn-sm'

.row
  .col-xs-12.teaser
    .text-holder
      - if @promotion.avatar
        %span.avatar.main-avatar= image_tag @promotion.avatar(:big), alt: @promotion.name, class: 'img-circle'
      %h1
        - if @promotion.private?
          %small
            %i.fa.fa-lock.istooltip{ title: 'Private group', data: { container: 'body' } }
        = link_to "#{@promotion.course.name} @#{@promotion.course.university.full_name}", course_path(@promotion.course)
        >
        = link_to @promotion.short_name, promotion_path(@promotion)

      - if @promotion.mini_resume.present?
        %p.user-mini-resume
          = @promotion.mini_resume
          - if @promotion.professor
            By
            = link_to @promotion.professor.user.name, @promotion.professor.user, title: 'Teaching professor', rel: 'tooltip'
      - elsif can? :update, @promotion
        %p.user-mini-resume
          No mini resume.
          = link_to 'Add one?', edit_promotion_path(@promotion), data: { remote: true }

      %p.user-categories
        - if @promotion.location
          %span.category.first
            %i.fa.fa-map-marker
              = @promotion.location
        - elsif can? :update, @promotion
          No location.
          = link_to 'Add one?', edit_promotion_path(@promotion), data: { remote: true }

      - if @promotion.websites.any?
        %ul.websites.list-inline
          - @promotion.websites.select{|t,u| u.present? }.each do |type, url|
            %li= render partial: "shared/website", locals: { type: type, url: url }
      - elsif can? :update, @promotion
        %ul.websites.list-inline
          %li
            No websites.
            = link_to 'Add some?', edit_promotion_path(@promotion), data: { remote: true }

    -# if current_user.id != @promotion.id
      - if current_user.try(:is_following?, @promotion)
        = link_to 'Following', user_followers_path(@promotion), method: :delete, class: 'btn-inverse btn-follow'
      - else
        = link_to 'Follow', user_followers_path(@promotion), method: :post, class: 'btn-follow'

- if can? :read, @promotion
  .row
    .col-xs-12
      .tabbable.tabs-left.navbar.navbar-default.navbar-tabs{ style: 'background: #fff;' }
        %ul.nav.navbar-nav
          %li.active= link_to "Projects", '#tab-projects', data: { toggle: 'tab' }
          %li= link_to "Assignments", '#tab-assignments', data: { toggle: 'tab' }
          %li= link_to "Students", '#tab-students', data: { toggle: 'tab' }
          %li= link_to "Staff", '#tab-staffs', data: { toggle: 'tab' }

          - if can? :manage, @promotion
            %li.dropdown
              %a.dropdown-toggle.action{ data: { toggle: 'dropdown' }, href: '#', title: 'Settings', rel: 'tooltip' }
                %i.fa.fa-cog
                %b.caret
              %ul.dropdown-menu
                %li= link_to 'Edit promotion', edit_promotion_path(@promotion), data: { remote: true }
                %li= link_to 'Manage members', promotion_edit_members_path(@promotion)
                %li= link_to 'Invite members', group_new_invitations_path(@promotion)
                %li= link_to 'New assignment', new_assignment_path(@promotion.assignments.new)